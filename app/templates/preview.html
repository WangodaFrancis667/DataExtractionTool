<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Preview: {{ filename }} - Document Extractor</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .preview-container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 1.5rem;
    }
    
    .preview-header {
      background: var(--white);
      border: 1px solid var(--border-green);
      border-radius: 8px;
      padding: 1.5rem 2rem;
      margin-bottom: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 2px 4px rgba(45, 80, 22, 0.05);
    }
    
    .preview-title {
      color: var(--primary-green);
      font-size: 1.125rem;
      font-weight: 600;
      margin: 0;
      word-break: break-all;
      line-height: 1.4;
    }
    
    .preview-actions {
      display: flex;
      gap: 0.75rem;
      flex-shrink: 0;
      margin-left: 1rem;
    }
    
    .preview-btn {
      background: var(--secondary-green);
      color: var(--white);
      text-decoration: none;
      padding: 0.625rem 1.25rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
      transition: all 0.2s ease;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      white-space: nowrap;
      border: 1px solid var(--secondary-green);
    }
    
    .preview-btn:hover {
      background: var(--primary-green);
      border-color: var(--primary-green);
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(45, 80, 22, 0.15);
    }
    
    .preview-btn.secondary {
      background: var(--white);
      color: var(--secondary-green);
      border: 1px solid var(--border-green);
    }
    
    .preview-btn.secondary:hover {
      background: var(--bg-green);
      border-color: var(--secondary-green);
    }
    
    .preview-content {
      background: var(--white);
      border: 1px solid var(--border-green);
      border-radius: 8px;
      padding: 1.5rem;
      min-height: 500px;
      box-shadow: 0 2px 4px rgba(45, 80, 22, 0.05);
      overflow: hidden;
    }
    
    .preview-meta {
      background: linear-gradient(135deg, var(--bg-green) 0%, #f4f8f1 100%);
      border: 1px solid var(--border-green);
      border-radius: 8px;
      padding: 1.25rem;
      margin-bottom: 1.5rem;
      font-size: 0.875rem;
      color: var(--text-medium);
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      align-items: center;
    }
    
    .meta-item {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .meta-label {
      font-weight: 600;
      color: var(--primary-green);
    }
    
    .meta-value {
      color: var(--text-dark);
      background: var(--white);
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-size: 0.8rem;
      border: 1px solid var(--border-green);
    }
    
    .preview-table {
      width: 100%;
      border-collapse: collapse;
      margin: 0;
      font-size: 0.8rem;
      background: var(--white);
      border-radius: 6px;
      overflow: hidden;
      box-shadow: 0 1px 3px rgba(45, 80, 22, 0.1);
    }
    
    .preview-table th,
    .preview-table td {
      padding: 0.875rem 1rem;
      border-bottom: 1px solid var(--border-green);
      text-align: left;
      vertical-align: top;
    }
    
    .preview-table th {
      background: linear-gradient(135deg, var(--primary-green) 0%, var(--secondary-green) 100%);
      color: var(--white);
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .preview-table tbody tr {
      transition: background-color 0.15s ease;
    }
    
    .preview-table tbody tr:nth-child(even) {
      background: #fafcfa;
    }
    
    .preview-table tbody tr:hover {
      background: var(--bg-green);
      transform: scale(1.001);
    }
    
    .preview-table td {
      border-right: 1px solid var(--border-green);
      color: var(--text-dark);
      line-height: 1.4;
    }
    
    .preview-table td:last-child {
      border-right: none;
    }
    
    .table-wrapper {
      background: var(--white);
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(45, 80, 22, 0.08);
      margin: 1rem 0;
    }
    
    .table-scroll {
      overflow-x: auto;
      overflow-y: auto;
      max-height: 70vh;
      border-radius: 8px;
    }
    
    .text-content {
      white-space: pre-wrap;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 0.875rem;
      line-height: 1.6;
      color: var(--text-dark);
      background: #fafbfa;
      padding: 1rem;
      border-radius: 4px;
      border: 1px solid var(--border-green);
      overflow-x: auto;
    }
    
    .json-content {
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 0.875rem;
      line-height: 1.5;
      color: var(--text-dark);
      background: #fafbfa;
      padding: 1rem;
      border-radius: 4px;
      border: 1px solid var(--border-green);
      overflow-x: auto;
      white-space: pre;
    }
    
    .sheet-tabs {
      display: flex;
      gap: 0.25rem;
      margin-bottom: 1.5rem;
      background: var(--bg-green);
      padding: 0.5rem;
      border-radius: 8px;
      border: 1px solid var(--border-green);
      overflow-x: auto;
    }
    
    .sheet-tab {
      background: var(--white);
      border: 1px solid var(--border-green);
      color: var(--text-medium);
      padding: 0.625rem 1.25rem;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.8rem;
      font-weight: 600;
      transition: all 0.2s ease;
      white-space: nowrap;
      flex-shrink: 0;
      text-transform: uppercase;
      letter-spacing: 0.025em;
    }
    
    .sheet-tab:hover {
      background: var(--bg-green);
      border-color: var(--secondary-green);
      color: var(--secondary-green);
    }
    
    .sheet-tab.active {
      background: var(--primary-green);
      color: var(--white);
      border-color: var(--primary-green);
      box-shadow: 0 2px 4px rgba(45, 80, 22, 0.15);
    }
    
    .sheet-content {
      display: none;
      animation: fadeIn 0.3s ease-in-out;
    }
    
    .sheet-content.active {
      display: block;
    }
    
    .sheet-title {
      color: var(--primary-green);
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--border-green);
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
      .preview-container {
        padding: 1rem;
      }
      
      .preview-header {
        padding: 1rem 1.5rem;
      }
      
      .preview-content {
        padding: 1rem;
      }
      
      .preview-meta {
        flex-direction: column;
        align-items: stretch;
        gap: 1rem;
      }
      
      .meta-item {
        justify-content: space-between;
      }
    }
    
    @media (max-width: 768px) {
      .preview-header {
        flex-direction: column;
        gap: 1rem;
        align-items: stretch;
        padding: 1rem;
      }
      
      .preview-title {
        font-size: 1rem;
        text-align: center;
        word-break: break-word;
      }
      
      .preview-actions {
        margin-left: 0;
        justify-content: center;
      }
      
      .sheet-tabs {
        padding: 0.25rem;
      }
      
      .sheet-tab {
        padding: 0.5rem 1rem;
        font-size: 0.75rem;
      }
      
      .preview-table {
        font-size: 0.7rem;
      }
      
      .preview-table th,
      .preview-table td {
        padding: 0.5rem 0.75rem;
      }
      
      .table-scroll {
        max-height: 60vh;
      }
    }
    
    @media (max-width: 480px) {
      .preview-container {
        padding: 0.5rem;
      }
      
      .preview-actions {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .preview-btn {
        padding: 0.75rem;
        text-align: center;
      }
      
      .meta-item {
        flex-direction: column;
        align-items: stretch;
        gap: 0.25rem;
      }
      
      .meta-value {
        text-align: center;
      }
      
      .preview-table {
        font-size: 0.65rem;
      }
      
      .preview-table th,
      .preview-table td {
        padding: 0.375rem 0.5rem;
      }
    }
    
    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .preview-content {
      animation: fadeIn 0.5s ease-in-out;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <div class="header-content">
        <h1 class="app-title">Document Extractor</h1>
        <p class="app-subtitle">File Preview</p>
      </div>
    </header>
    
    <div class="preview-container">
      <div class="preview-header">
        <h2 class="preview-title">{{ filename }}</h2>
        <div class="preview-actions">
          <a href="{{ url_for('main.download', filename=filename) }}" class="preview-btn">Download</a>
          <a href="{{ url_for('main.index') }}" class="preview-btn secondary">Back to Home</a>
        </div>
      </div>
      
      {% if file_type == 'text' %}
        <div class="preview-meta">
          <div class="meta-item">
            <span class="meta-label">File Type:</span>
            <span class="meta-value">Text Document</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Content:</span>
            <span class="meta-value">Extracted text content</span>
          </div>
        </div>
        <div class="preview-content">
          <div class="text-content">{{ content }}</div>
        </div>
      
      {% elif file_type == 'csv' %}
        <div class="preview-meta">
          <div class="meta-item">
            <span class="meta-label">File Type:</span>
            <span class="meta-value">CSV Data</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Rows:</span>
            <span class="meta-value">{{ row_count }}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Format:</span>
            <span class="meta-value">Comma-separated values</span>
          </div>
        </div>
        <div class="preview-content">
          <div class="table-wrapper">
            <div class="table-scroll">
              {{ content|safe }}
            </div>
          </div>
        </div>
      
      {% elif file_type == 'json' %}
        <div class="preview-meta">
          <div class="meta-item">
            <span class="meta-label">File Type:</span>
            <span class="meta-value">JSON Data</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Content:</span>
            <span class="meta-value">Structured field data</span>
          </div>
        </div>
        <div class="preview-content">
          <div class="json-content">{{ content }}</div>
        </div>
      
      {% elif file_type == 'xlsx' %}
        <div class="preview-meta">
          <div class="meta-item">
            <span class="meta-label">File Type:</span>
            <span class="meta-value">Excel Workbook</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Sheets:</span>
            <span class="meta-value">{{ content.keys()|length }}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Format:</span>
            <span class="meta-value">Multi-sheet Excel file</span>
          </div>
        </div>
        <div class="preview-content">
          {% if content.keys()|length > 1 %}
            <div class="sheet-tabs">
              {% for sheet_name in content.keys() %}
                <div class="sheet-tab {% if loop.first %}active{% endif %}" 
                     onclick="showSheet('{{ loop.index0 }}')">
                  {{ sheet_name }}
                </div>
              {% endfor %}
            </div>
          {% endif %}
          
          {% for sheet_name, sheet_html in content.items() %}
            <div class="sheet-content {% if loop.first %}active{% endif %}" id="sheet-{{ loop.index0 }}">
              {% if content.keys()|length > 1 %}
                <h3 class="sheet-title">{{ sheet_name }}</h3>
              {% endif %}
              <div class="table-wrapper">
                <div class="table-scroll">
                  {{ sheet_html|safe }}
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
      {% endif %}
    </div>
    
    <footer class="app-footer">
      <div class="footer-content">
        <p class="footer-text">Secure local processing • File preview • Enterprise-grade extraction</p>
      </div>
    </footer>
  </div>
  
  <script>
    function showSheet(index) {
      // Hide all sheet contents with fade effect
      const contents = document.querySelectorAll('.sheet-content');
      contents.forEach(content => {
        content.style.opacity = '0';
        setTimeout(() => {
          content.classList.remove('active');
          content.style.opacity = '1';
        }, 150);
      });
      
      // Remove active class from all tabs
      const tabs = document.querySelectorAll('.sheet-tab');
      tabs.forEach(tab => tab.classList.remove('active'));
      
      // Show selected sheet and activate tab with delay for smooth transition
      setTimeout(() => {
        document.getElementById('sheet-' + index).classList.add('active');
        document.querySelectorAll('.sheet-tab')[index].classList.add('active');
      }, 150);
    }
    
    // Enhanced table and UI improvements
    document.addEventListener('DOMContentLoaded', function() {
      // Add loading state
      document.body.style.opacity = '0';
      setTimeout(() => {
        document.body.style.transition = 'opacity 0.5s ease-in-out';
        document.body.style.opacity = '1';
      }, 100);
      
      // Enhance tables with better interaction
      const tables = document.querySelectorAll('.preview-table');
      tables.forEach(table => {
        // Add row numbers for better readability
        const tbody = table.querySelector('tbody');
        if (tbody) {
          const rows = tbody.querySelectorAll('tr');
          rows.forEach((row, index) => {
            // Add subtle hover effect timing
            row.addEventListener('mouseenter', function() {
              this.style.transform = 'scale(1.002)';
            });
            row.addEventListener('mouseleave', function() {
              this.style.transform = 'scale(1)';
            });
          });
        }
      });
      
      // Add keyboard navigation for sheet tabs
      document.addEventListener('keydown', function(e) {
        const tabs = document.querySelectorAll('.sheet-tab');
        if (tabs.length > 1) {
          const activeTab = document.querySelector('.sheet-tab.active');
          const currentIndex = Array.from(tabs).indexOf(activeTab);
          
          if (e.key === 'ArrowLeft' && currentIndex > 0) {
            showSheet(currentIndex - 1);
          } else if (e.key === 'ArrowRight' && currentIndex < tabs.length - 1) {
            showSheet(currentIndex + 1);
          }
        }
      });
      
      // Add touch/swipe support for mobile sheet navigation
      let startX = null;
      const container = document.querySelector('.preview-content');
      
      container.addEventListener('touchstart', function(e) {
        startX = e.touches[0].clientX;
      });
      
      container.addEventListener('touchend', function(e) {
        if (!startX) return;
        
        const endX = e.changedTouches[0].clientX;
        const diffX = startX - endX;
        
        const tabs = document.querySelectorAll('.sheet-tab');
        if (tabs.length > 1 && Math.abs(diffX) > 50) {
          const activeTab = document.querySelector('.sheet-tab.active');
          const currentIndex = Array.from(tabs).indexOf(activeTab);
          
          if (diffX > 0 && currentIndex < tabs.length - 1) {
            // Swipe left - next sheet
            showSheet(currentIndex + 1);
          } else if (diffX < 0 && currentIndex > 0) {
            // Swipe right - previous sheet
            showSheet(currentIndex - 1);
          }
        }
        
        startX = null;
      });
      
      // Add scroll position indicator for tables
      const scrollContainers = document.querySelectorAll('.table-scroll');
      scrollContainers.forEach(container => {
        const table = container.querySelector('table');
        if (table && table.scrollWidth > container.clientWidth) {
          // Add scroll indicator
          const indicator = document.createElement('div');
          indicator.style.cssText = `
            position: absolute;
            bottom: 0;
            right: 0;
            background: var(--primary-green);
            color: white;
            padding: 0.25rem 0.5rem;
            font-size: 0.7rem;
            border-radius: 4px 0 0 0;
            pointer-events: none;
          `;
          indicator.textContent = '← Scroll →';
          container.style.position = 'relative';
          container.appendChild(indicator);
          
          // Hide indicator on scroll
          container.addEventListener('scroll', function() {
            const scrollPercentage = this.scrollLeft / (this.scrollWidth - this.clientWidth);
            indicator.style.opacity = 1 - scrollPercentage;
          });
        }
      });
    });
  </script>
</body>
</html>